<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>FairwayCaddie ‚Äî Manage Your Golf League</title>
  <meta name="description" content="Free golf league management app. Create teams, track scores, handicaps, standings, skins, and more. Built for weekly 9-hole match play leagues." />
  <meta name="theme-color" content="#0d1f14" />

  <!-- Open Graph / Social -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://fairwaycaddie.com/" />
  <meta property="og:title" content="FairwayCaddie ‚Äî Manage Your Golf League" />
  <meta property="og:description" content="Free golf league management. Teams, scores, handicaps, standings, skins & more." />
  <meta property="og:image" content="https://fairwaycaddie.com/og-image.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <link rel="canonical" href="https://fairwaycaddie.com/" />

  <!-- Favicon & PWA -->
  <link rel="icon" href="/icon-192.png" type="image/png" />
  <link rel="apple-touch-icon" href="/icon-192.png" />
  <link rel="manifest" href="/manifest.json" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <!-- Sentry Error Tracking -->
  <script src="https://browser.sentry-cdn.com/8.49.0/bundle.min.js" crossorigin="anonymous"></script>
  <script>
    if (window.Sentry) {
      Sentry.init({
        dsn: "YOUR_SENTRY_DSN_HERE",  // TODO: Replace with real DSN from sentry.io
        environment: location.hostname === 'localhost' ? 'development' : 'production',
        release: "fairwaycaddie@1.0.0",
        tracesSampleRate: 0.2,
        sampleRate: 1.0,
        ignoreErrors: [
          /^ResizeObserver loop/,
          /^Non-Error promise rejection/,
          /quota-exceeded/,
          /Failed to get document because the client is offline/,
          /blocked by client/i,
        ],
        beforeBreadcrumb(breadcrumb) {
          if (breadcrumb.category === 'console' && breadcrumb.level === 'log') return null;
          return breadcrumb;
        },
      });
    }
  </script>

  <link rel="stylesheet" href="styles.css?v=5" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=Dela+Gothic+One&display=swap" rel="stylesheet" />
</head>
<body>
<a href="#tab-dashboard" class="skip-link">Skip to content</a>
<div id="offline-banner" role="alert">You're offline ‚Äî scores will sync when reconnected</div>

<!-- ===== LANDING PAGE ===== -->
<section id="view-splash" class="view active">

  <!-- HERO -->
  <div class="landing-hero">
    <div class="splash-bg-overlay"></div>
    <div class="landing-hero-content">
      <div class="splash-icon"><img src="/logo.png" alt="FairwayCaddie" class="hero-logo" /></div>
      <h1 class="splash-title sr-only">FairwayCaddie</h1>
      <p class="hero-slogan-line1">Built for League Night.</p>
      <p class="hero-slogan-line2">Because Golf League Rules.</p>
      <div id="splash-btns" class="splash-cta-group" style="display:none">
        <button class="btn-primary" id="btn-create-league">Get Started Free</button>
        <button class="btn-secondary" id="btn-sign-in">Sign In</button>
      </div>
      <div id="splash-loading" style="margin-top:16px;display:flex;align-items:center;gap:8px;justify-content:center"><span class="spinner" style="width:14px;height:14px;color:var(--gd)"></span><span style="color:var(--mt);font-size:13px">Checking in‚Ä¶</span></div>
    </div>
    <div class="landing-scroll-hint" onclick="document.querySelector('.landing-features').scrollIntoView({behavior:'smooth'})">
      <span>See what's inside</span>
      <span class="scroll-arrow">‚Üì</span>
    </div>
  </div>

  <!-- FEATURES -->
  <div class="landing-features">
    <h2 class="landing-section-title">Everything your league needs</h2>
    <div class="landing-features-grid">
      <div class="landing-feature-card">
        <div class="feature-icon">
          <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="12" width="4" height="9"/><rect x="10" y="7" width="4" height="14"/><rect x="17" y="3" width="4" height="18"/></svg>
        </div>
        <h3>Live Standings</h3>
        <p>Points, wins, losses, and team rankings update automatically after every match.</p>
      </div>
      <div class="landing-feature-card">
        <div class="feature-icon">
          <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="6" x2="20" y2="6"/><line x1="4" y1="12" x2="20" y2="12"/><line x1="4" y1="18" x2="20" y2="18"/><circle cx="8" cy="6" r="2"/><circle cx="16" cy="12" r="2"/><circle cx="10" cy="18" r="2"/></svg>
        </div>
        <h3>Flexible Scoring</h3>
        <p>Match play, stroke play, Stableford ‚Äî pick your format. Configure points, net vs. gross, bonuses, and skins to fit your league exactly.</p>
      </div>
      <div class="landing-feature-card">
        <div class="feature-icon">
          <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
        </div>
        <h3>Handicap Tracking</h3>
        <p>Rolling handicaps auto-calculated from recent rounds. Manual adjustments available.</p>
      </div>
      <div class="landing-feature-card">
        <div class="feature-icon">
          <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        </div>
        <h3>Season Schedule</h3>
        <p>Full schedule with tee times, matchups, front/back nines, and playoff brackets.</p>
      </div>
      <div class="landing-feature-card">
        <div class="feature-icon">
          <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
        </div>
        <h3>Skins Game</h3>
        <p>Optional skins pot tracked alongside match play. Gross or net ‚Äî your call.</p>
      </div>
      <div class="landing-feature-card">
        <div class="feature-icon">
          <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="5" y="2" width="14" height="20" rx="2"/><line x1="12" y1="18" x2="12.01" y2="18" stroke-width="3"/></svg>
        </div>
        <h3>Mobile First</h3>
        <p>Enter scores from the course on any phone. Works offline-ready as a web app.</p>
      </div>
    </div>
  </div>

  <!-- FEATURE REQUEST CALLOUT -->
  <div class="landing-custom-callout">
    <div class="custom-callout-tag">Custom Builds</div>
    <h3 class="custom-callout-heading">Run your league different?</h3>
    <p class="custom-callout-body">Got a format or rule we don't support yet? Let us know ‚Äî we can build it and turn it around in 24 hours.</p>
    <a href="mailto:trey.fish23@gmail.com?subject=FairwayCaddie Feature Request" class="custom-callout-btn">Request a Feature ‚Üí</a>
  </div>

  <!-- HOW IT WORKS -->
  <div class="landing-how">
    <h2 class="landing-section-title">Up and running in minutes</h2>
    <div class="landing-steps">
      <div class="landing-step">
        <div class="step-number">1</div>
        <h3>Create your league</h3>
        <p>Set up your teams, pick your course, and build the season schedule.</p>
      </div>
      <div class="landing-step-connector"></div>
      <div class="landing-step">
        <div class="step-number">2</div>
        <h3>Invite your players</h3>
        <p>Share a 6-character join code. Everyone signs in with Google or email.</p>
      </div>
      <div class="landing-step-connector"></div>
      <div class="landing-step">
        <div class="step-number">3</div>
        <h3>Play and track</h3>
        <p>Scores, standings, handicaps, and stats update automatically all season.</p>
      </div>
    </div>
  </div>

  <!-- BOTTOM CTA -->
  <div class="landing-cta">
    <h2>‚õ≥ Ready to tee off?</h2>
    <p>Free to create. Free to play.</p>
    <button class="btn-primary" onclick="document.getElementById('btn-create-league').click()">Create Your League</button>
    <button class="btn-text" onclick="document.getElementById('btn-sign-in').click()" style="display:block;margin:12px auto 0;color:var(--mt)">Already have an account? Sign In</button>
  </div>

  <!-- FOOTER -->
  <div class="landing-footer">
    <div class="splash-title" style="font-size:18px">Fairway<span>Caddie</span></div>
    <div class="landing-footer-links">
      <button class="btn-text" onclick="showView('terms')">Terms of Service</button>
      <span style="color:var(--mt)">¬∑</span>
      <button class="btn-text" onclick="showView('privacy')">Privacy Policy</button>
    </div>
    <p class="landing-footer-tagline">Made for golfers, by golfers.</p>
  </div>

</section>

<!-- ===== SIGN IN ===== -->
<section id="view-signin" class="view">
  <div class="auth-card">
    <button class="btn-ghost" onclick="showView('splash')" style="margin-bottom:16px;text-align:left">‚Üê Back</button>
    <h2>Sign In</h2>
    <p class="auth-sub">Welcome back</p>
    <button class="google-btn" id="btn-google-signin">
      <svg viewBox="0 0 24 24"><path fill="#fff" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#fff" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#fff" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z"/><path fill="#fff" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
      Continue with Google
    </button>
    <div class="auth-divider">or</div>
    <form id="signin-form">
      <div class="field">
        <label>Email</label>
        <input type="email" id="signin-email" placeholder="you@example.com" autocomplete="email" />
      </div>
      <div class="field">
        <label>Password</label>
        <input type="password" id="signin-pass" placeholder="Password" autocomplete="current-password" />
      </div>
      <button type="submit" class="btn-primary" style="width:100%">Sign In</button>
    </form>
    <div style="text-align:center;margin-top:10px">
      <button class="btn-text" id="link-forgot-password" style="font-size:13px;color:var(--mt)">Forgot password?</button>
    </div>
    <div class="auth-footer">
      No account? <button class="btn-text" id="link-to-signup">Create one</button>
    </div>
  </div>
</section>

<!-- ===== FORGOT PASSWORD ===== -->
<section id="view-forgot-password" class="view">
  <div class="auth-card">
    <button class="btn-ghost" onclick="showView('signin')" style="margin-bottom:16px;text-align:left">‚Üê Back to Sign In</button>
    <h2>Reset Password</h2>
    <p class="auth-sub">Enter your email and we'll send a reset link</p>
    <form id="forgot-password-form">
      <div class="field">
        <label>Email</label>
        <input type="email" id="forgot-email" placeholder="you@example.com" autocomplete="email" />
      </div>
      <button type="submit" class="btn-primary" style="width:100%">Send Reset Link</button>
    </form>
    <div id="forgot-success" style="display:none;text-align:center;margin-top:20px">
      <div style="font-size:32px;margin-bottom:10px">üìß</div>
      <p style="color:var(--fg);font-weight:600;margin-bottom:6px">Check your email</p>
      <p style="color:var(--mt);font-size:13px">We sent a password reset link. It may take a minute to arrive.</p>
      <button class="btn-text" onclick="showView('signin')" style="margin-top:16px">‚Üê Back to Sign In</button>
    </div>
  </div>
</section>

<!-- ===== VERIFY EMAIL ===== -->
<section id="view-verify-email" class="view">
  <div class="auth-card" style="text-align:center">
    <div style="font-size:48px;margin-bottom:12px">üì¨</div>
    <h2>Verify Your Email</h2>
    <p class="auth-sub">We sent a verification link to <strong id="verify-email-addr"></strong></p>
    <p style="color:var(--mt);font-size:13px;margin-top:12px">Click the link in the email to activate your account, then come back here.</p>
    <button class="btn-primary" id="btn-check-verification" style="width:100%;margin-top:20px">I've Verified ‚Äî Continue</button>
    <div style="margin-top:14px">
      <button class="btn-text" id="btn-resend-verification" style="font-size:13px;color:var(--mt)">Resend verification email</button>
    </div>
    <div style="margin-top:16px">
      <button class="btn-ghost" id="btn-verify-signout" style="font-size:13px">Sign out</button>
    </div>
  </div>
</section>

<!-- ===== SIGN UP ===== -->
<section id="view-signup" class="view">
  <div class="auth-card">
    <button class="btn-ghost" onclick="showView('splash')" style="margin-bottom:16px;text-align:left">‚Üê Back</button>
    <h2>Create Account</h2>
    <p class="auth-sub">Join or start a golf league</p>
    <button class="google-btn" id="btn-google-signup">
      <svg viewBox="0 0 24 24"><path fill="#fff" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#fff" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#fff" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z"/><path fill="#fff" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
      Sign up with Google
    </button>
    <div class="auth-divider">or</div>
    <form id="signup-form">
      <div class="field">
        <label>Name</label>
        <input type="text" id="signup-name" placeholder="Your name" autocomplete="name" />
      </div>
      <div class="field">
        <label>Email</label>
        <input type="email" id="signup-email" placeholder="you@example.com" autocomplete="email" />
      </div>
      <div class="field">
        <label>Password</label>
        <input type="password" id="signup-pass" placeholder="Min 6 characters" autocomplete="new-password" />
      </div>
      <div style="margin:14px 0 6px;display:flex;align-items:flex-start;gap:8px">
        <input type="checkbox" id="signup-agree-tos" style="margin-top:3px;accent-color:var(--ac);width:16px;height:16px;flex-shrink:0" />
        <label for="signup-agree-tos" style="font-size:12px;color:var(--mt);line-height:1.5;cursor:pointer">
          I agree to the <button type="button" class="btn-text" onclick="showView('terms')" style="font-size:12px">Terms of Service</button>
          and <button type="button" class="btn-text" onclick="showView('privacy')" style="font-size:12px">Privacy Policy</button>
        </label>
      </div>
      <button type="submit" class="btn-primary" style="width:100%">Create Account</button>
    </form>
    <div class="auth-footer">
      Already have an account? <button class="btn-text" id="link-to-signin">Sign in</button>
    </div>
  </div>
</section>

<!-- ===== LEAGUE SELECT ===== -->
<section id="view-league-select" class="view">
  <div class="league-select-header">
    <h2>Your Leagues</h2>
    <button class="btn-primary" id="btn-new-league" style="width:auto;padding:10px 20px">+ New League</button>
  </div>
  <div id="league-list">
    <div class="league-empty"><p>Loading‚Ä¶</p></div>
  </div>
  <div style="margin-top:20px;text-align:center">
    <button class="btn-ghost" onclick="handleSignOut()">Sign Out</button>
  </div>
</section>

<!-- ===== CREATE LEAGUE WIZARD ===== -->
<section id="view-wizard" class="view">
  <div class="wizard-header">
    <button class="btn-wizard-back" onclick="wizardBack()" id="wizard-back-btn">‚Üê Back</button>
    <h2 id="wizard-title">Create League</h2>
    <div class="wizard-progress">
      <div class="wizard-dot active"></div>
      <div class="wizard-dot"></div>
      <div class="wizard-dot"></div>
      <div class="wizard-dot"></div>
      <div class="wizard-dot"></div>
      <div class="wizard-dot"></div>
    </div>
  </div>

  <div class="wizard-body">

    <!-- Step 1: League Info -->
    <div class="wizard-step active">
      <h2 class="wizard-step-title">League Info</h2>
      <p class="wizard-step-sub">Tell us about your league</p>

      <div class="wizard-section">
        <div class="wizard-section-title">Basics</div>
        <div class="field">
          <label>League Name</label>
          <input type="text" id="wz-league-name" placeholder="e.g. Monday Beer League" />
        </div>

        <div class="field">
          <label>Import Player History (CSV) <span class="info-btn" data-tip="Upload FringeGolfers export CSVs to pre-fill handicaps and seed player names into your roster">?</span></label>
          <div class="upload-zone" id="hcp-import-zone-s1"
            onclick="document.getElementById('hcp-csv-file-s1').click()"
            ondragover="event.preventDefault(); this.classList.add('drag-over')"
            ondragleave="this.classList.remove('drag-over')"
            ondrop="handleHcpCsvDrop(event, 's1')"
            style="padding:16px 14px">
            <span style="font-size:22px">üìÇ</span>
            <p style="margin:4px 0 2px"><strong>Drop CSV files here or click to browse</strong></p>
            <p style="font-size:12px;color:var(--mt);margin:0">Accepts multiple files ¬∑ FringeGolfers export format</p>
          </div>
          <input type="file" id="hcp-csv-file-s1" accept=".csv,.txt" multiple style="display:none"
            onchange="handleHcpCsvFiles(this.files)" />

          <!-- CSV Format Example -->
          <details style="margin-top:10px" ontoggle="document.getElementById('csv-fmt-arrow').style.transform=this.open?'rotate(90deg)':''">
            <summary style="font-size:12px;color:var(--mt);cursor:pointer;user-select:none;list-style:none;display:flex;align-items:center;gap:5px">
              <span style="font-size:10px;transition:transform .2s" id="csv-fmt-arrow">‚ñ∂</span>
              <span>View expected CSV format</span>
            </summary>
            <div style="margin-top:8px;padding:12px;background:rgba(0,0,0,0.25);border-radius:8px;border:1px solid var(--bd)">
              <p style="font-size:11px;color:var(--mt);margin:0 0 8px 0;font-weight:600;text-transform:uppercase;letter-spacing:.05em">FringeGolfers Export Format</p>
              <div style="overflow-x:auto">
                <table style="width:100%;border-collapse:collapse;font-size:11px;font-family:monospace">
                  <thead>
                    <tr>
                      <th style="padding:4px 8px;text-align:left;background:rgba(255,255,255,0.05);color:var(--mt);border:1px solid var(--bd)">Player Name</th>
                      <th style="padding:4px 8px;text-align:left;background:rgba(255,255,255,0.05);color:var(--mt);border:1px solid var(--bd)">Date</th>
                      <th style="padding:4px 8px;text-align:left;background:rgba(255,255,255,0.05);color:var(--mt);border:1px solid var(--bd)">Course</th>
                      <th style="padding:4px 8px;text-align:left;background:rgba(255,255,255,0.05);color:var(--mt);border:1px solid var(--bd)">Score</th>
                      <th style="padding:4px 8px;text-align:left;background:rgba(255,255,255,0.05);color:var(--mt);border:1px solid var(--bd)">(extra)</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td style="padding:4px 8px;border:1px solid var(--bd);color:var(--fg)">"Fisher, Trey"</td>
                      <td style="padding:4px 8px;border:1px solid var(--bd);color:var(--fg)">"2025-05-13"</td>
                      <td style="padding:4px 8px;border:1px solid var(--bd);color:var(--fg)">"Wellshire GC"</td>
                      <td style="padding:4px 8px;border:1px solid var(--fg-accent,#6fcf97)"><strong>"39 (+4)"</strong></td>
                      <td style="padding:4px 8px;border:1px solid var(--bd);color:var(--mt)">""</td>
                    </tr>
                    <tr>
                      <td style="padding:4px 8px;border:1px solid var(--bd);color:var(--fg)">"Butler, Matt"</td>
                      <td style="padding:4px 8px;border:1px solid var(--bd);color:var(--fg)">"2025-05-13"</td>
                      <td style="padding:4px 8px;border:1px solid var(--bd);color:var(--fg)">"Wellshire GC"</td>
                      <td style="padding:4px 8px;border:1px solid var(--fg-accent,#6fcf97)"><strong>"52 (+17)"</strong></td>
                      <td style="padding:4px 8px;border:1px solid var(--bd);color:var(--mt)">""</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <ul style="font-size:11px;color:var(--mt);margin:10px 0 0 0;padding-left:16px;line-height:1.7">
                <li><strong style="color:var(--fg)">Player Name</strong> ‚Äî Last, First (quoted)</li>
                <li><strong style="color:var(--fg)">Date</strong> ‚Äî YYYY-MM-DD format</li>
                <li><strong style="color:var(--fg)">Score</strong> ‚Äî gross score followed by (+over par) in quotes</li>
                <li>Export directly from <strong style="color:var(--fg)">FringeGolfers</strong> ‚Üí Score History ‚Üí Export CSV</li>
                <li>Multiple files accepted ‚Äî duplicates (same player + date) are skipped</li>
              </ul>
            </div>
          </details>

          <div id="hcp-import-status" style="font-size:12px;margin-top:8px;color:var(--mt)"></div>
          <div id="hcp-preview-wrap" style="display:none;margin-top:12px">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
              <span id="hcp-preview-title" style="font-size:12px;font-weight:600;color:var(--gd)"></span>
              <button class="btn-ghost" style="font-size:11px;padding:4px 10px"
                onclick="clearHcpImport()">‚úï Clear</button>
            </div>
            <div style="overflow-x:auto">
              <table id="hcp-preview-table" style="width:100%;border-collapse:collapse;font-size:12px">
                <thead>
                  <tr>
                    <th style="text-align:left;padding:5px 8px;border-bottom:1px solid var(--bd);color:var(--mt)">Player</th>
                    <th style="text-align:center;padding:5px 8px;border-bottom:1px solid var(--bd);color:var(--mt)">Rounds</th>
                    <th style="text-align:center;padding:5px 8px;border-bottom:1px solid var(--bd);color:var(--mt)">Avg</th>
                    <th style="text-align:center;padding:5px 8px;border-bottom:1px solid var(--bd);color:var(--mt)">Best</th>
                    <th style="text-align:center;padding:5px 8px;border-bottom:1px solid var(--bd);color:var(--mt)">Est. Hcp</th>
                  </tr>
                </thead>
                <tbody id="hcp-preview-tbody"></tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="field-row">
          <div class="field">
            <label>Season Start</label>
            <input type="date" id="wz-season-start" />
          </div>
          <div class="field">
            <label>Season End</label>
            <input type="date" id="wz-season-end" />
          </div>
        </div>
        <div class="field">
          <label>Day of Week</label>
          <div class="toggle-group" id="tg-day">
            <button class="toggle-btn active" data-value="Monday">Mon</button>
            <button class="toggle-btn" data-value="Tuesday">Tue</button>
            <button class="toggle-btn" data-value="Wednesday">Wed</button>
            <button class="toggle-btn" data-value="Thursday">Thu</button>
            <button class="toggle-btn" data-value="Friday">Fri</button>
            <button class="toggle-btn" data-value="Saturday">Sat</button>
            <button class="toggle-btn" data-value="Sunday">Sun</button>
          </div>
          <input type="hidden" id="wz-day-val" value="Monday" />
        </div>
        <div class="field-row">
          <div class="field">
            <label>Starting Tee Time</label>
            <input type="time" id="wz-tee-time" value="16:00" />
          </div>
          <div class="field">
            <label>Tee Time Interval (min)</label>
            <select id="wz-tee-interval">
              <option value="8">8 min</option>
              <option value="10" selected>10 min</option>
              <option value="12">12 min</option>
              <option value="15">15 min</option>
              <option value="20">20 min</option>
            </select>
          </div>
        </div>
      </div>

      <div class="wizard-section">
        <div class="wizard-section-title">Format</div>
        <div class="field">
          <label>Holes Per Round</label>
          <div class="toggle-group" id="tg-nines">
            <button class="toggle-btn active" data-value="9">9 Holes</button>
            <button class="toggle-btn" data-value="18">18 Holes</button>
          </div>
          <input type="hidden" id="wz-nines-val" value="9" />
        </div>
        <div class="field">
          <label>Players Per Team</label>
          <div class="toggle-group" id="tg-ppt">
            <button class="toggle-btn" data-value="1">1</button>
            <button class="toggle-btn active" data-value="2">2</button>
            <button class="toggle-btn" data-value="3">3</button>
            <button class="toggle-btn" data-value="4">4</button>
          </div>
          <input type="hidden" id="wz-players-per-team-val" value="2" />
        </div>
        <div class="field">
          <label>Total Players in League</label>
          <input type="number" id="wz-total-players" placeholder="e.g. 24" min="2" max="200" />
          <p class="field-hint">Optional ‚Äî used for tee sheet planning</p>
        </div>
      </div>
    </div>

    <!-- Step 2: Teams & Players -->
    <div class="wizard-step">
      <h2 class="wizard-step-title">Teams & Players</h2>
      <p class="wizard-step-sub">Import your roster, then drag players onto teams</p>

      <!-- Player Pool -->
      <div class="wizard-section">
        <div class="wizard-section-title">Player Roster
          <button class="btn-ghost" style="font-size:11px;padding:2px 8px;float:right" onclick="toggleImportPanel()">üìã Paste / Import</button>
        </div>

        <!-- Import panel (collapsed by default) -->
        <div id="import-panel" style="display:none;margin-bottom:12px">
          <p class="field-hint" style="margin-bottom:6px">One name per line, or comma-separated. Hit Import to add to pool.</p>
          <textarea id="import-names-input" rows="5"
            placeholder="e.g.&#10;Trey Fisher&#10;Matt Butler&#10;Kyle Maierhofer&#10;Trevor Platt"
            style="width:100%;background:var(--ip);border:1px solid var(--bd);border-radius:8px;color:var(--tx);padding:10px 12px;font-family:inherit;font-size:13px;resize:vertical;line-height:1.6"></textarea>
          <div style="display:flex;gap:8px;margin-top:8px;align-items:center;flex-wrap:wrap">
            <button class="btn-primary" onclick="importPlayerNames()" style="width:auto;padding:9px 18px;font-size:13px">Import ‚Üí</button>
            <label class="btn-ghost" style="cursor:pointer;font-size:13px;padding:8px 14px">
              üìÇ Load file
              <input type="file" id="import-names-file" accept=".txt,.csv" multiple style="display:none" onchange="loadImportFile(this)" />
            </label>
            <span id="import-status" style="font-size:12px;color:var(--gd)"></span>
          </div>
        </div>

        <!-- Unassigned player pool (drag source) -->
        <div id="player-pool"
          class="player-pool"
          ondragover="event.preventDefault()"
          ondrop="dropOnPool(event)"
          ondragenter="this.classList.add('drag-over')"
          ondragleave="this.classList.remove('drag-over')">
          <span class="player-pool-empty" id="pool-empty-hint">No players yet ‚Äî paste names above or add manually below</span>
        </div>

        <!-- Add single player manually -->
        <div style="display:flex;gap:8px;margin-top:10px">
          <input type="text" id="add-player-name-inp" placeholder="Add a player‚Ä¶" style="flex:1" onkeydown="if(event.key==='Enter')addPlayerToPool()" />
          <button class="btn-ghost" style="white-space:nowrap" onclick="addPlayerToPool()">+ Add</button>
        </div>
      </div>

      <!-- Teams (drag targets) -->
      <div class="wizard-section">
        <div class="wizard-section-title">Teams
          <button class="btn-ghost" style="font-size:11px;padding:2px 8px;float:right" onclick="addTeam()">+ Add Team</button>
        </div>
        <div id="teams-container"></div>
      </div>
    </div>

    <!-- Step 3: Course Setup -->
    <div class="wizard-step">
      <h2 class="wizard-step-title">Course Setup</h2>
      <p class="wizard-step-sub">Find your course or enter info manually</p>

      <!-- Course Search via GolfCourseAPI -->
      <div class="wizard-section" id="wz-course-search-section">
        <div class="wizard-section-title">üîç Search Course Database</div>
        <p class="field-hint mb-12">Search 30,000+ courses to auto-fill your scorecard</p>
        <div class="course-search-wrap">
          <input type="text" id="wz-course-search" class="field" placeholder="Start typing a course name..." autocomplete="off" oninput="_debounceCourseSearch()" />
          <div id="wz-course-results" class="course-dropdown"></div>
        </div>
        <div id="wz-tee-selector" style="display:none"></div>
        <div id="wz-course-selected" style="display:none"></div>
        <div id="wz-course-not-found" class="course-not-found-link">
          <a href="#" onclick="showCourseRequestForm(); return false;">Course not listed? Request it here</a>
        </div>
      </div>

      <div class="wizard-divider-or"><span>or enter manually</span></div>

      <div class="wizard-section">
        <div class="wizard-section-title">Course Info</div>
        <div class="field">
          <label>Course Name</label>
          <input type="text" id="wz-course-name" placeholder="e.g. Wellshire Golf Course" />
        </div>
        <div class="field-row">
          <div class="field">
            <label>City / State</label>
            <input type="text" id="wz-course-city" placeholder="Denver, CO" />
          </div>
          <div class="field">
            <label>Tees</label>
            <input type="text" id="wz-tees" placeholder="e.g. Bronze, Blue, White" />
          </div>
        </div>
      </div>

      <div class="wizard-section">
        <div class="wizard-section-title">Scorecard</div>
        <div class="tab-group">
          <button class="tab-btn" data-tab="photo">üì∑ Upload Photo</button>
          <button class="tab-btn active" data-tab="manual">‚úèÔ∏è Enter Manually</button>
        </div>

        <!-- Photo upload tab -->
        <div class="tab-content" data-tab="photo">
          <div class="upload-zone" id="upload-zone" onclick="document.getElementById('scorecard-file').click()">
            <span class="upload-zone-icon">üì∑</span>
            <p><strong>Tap to upload a scorecard photo</strong></p>
            <p>We'll try to read the hole data automatically</p>
          </div>
          <input type="file" id="scorecard-file" accept="image/*" style="display:none" />
          <div class="upload-preview" id="upload-preview">
            <img id="upload-preview-img" src="" alt="Scorecard preview" />
          </div>
          <div class="ocr-status" id="ocr-status"></div>
        </div>

        <!-- Manual entry tab -->
        <div class="tab-content active" data-tab="manual">
          <p class="field-hint mb-12">Enter par, handicap, and yardage for each hole.</p>
          <div style="margin-bottom:8px;font-size:11px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--gd)">Front 9</div>
          <div id="scorecard-front-container"></div>
          <div style="margin-top:16px;margin-bottom:8px;font-size:11px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--gd)">Back 9</div>
          <div id="scorecard-back-container"></div>
        </div>
      </div>
    </div>

    <!-- Step 4: Format -->
    <div class="wizard-step">
      <h2 class="wizard-step-title">League Format</h2>
      <p class="wizard-step-sub">How does your league compete?</p>

      <div class="wizard-section">
        <div class="wizard-section-title">Scoring Format</div>
        <div class="field">
          <div id="format-picker" class="format-picker"></div>
          <input type="hidden" id="wz-format-val" value="match_play" />
        </div>
        <div class="field">
          <label>HI / LO Player Split</label>
          <div class="toggle-group" id="tg-hilo">
            <button class="toggle-btn active" data-value="yes">Yes</button>
            <button class="toggle-btn" data-value="no">No</button>
          </div>
          <input type="hidden" id="wz-hilo-val" value="yes" />
          <p class="field-hint">Each team's players compete as High and Low handicapper</p>
        </div>
      </div>

      <div class="wizard-section">
        <div class="wizard-section-title">Point Values</div>
        <p class="field-hint" style="margin-bottom:14px">Customize how many points each event is worth. Default is standard match play (10 pts max per match).</p>

        <div class="pts-grid">

          <!-- Hole win -->
          <div class="pts-row">
            <div class="pts-row-label">
              <span class="pts-row-name">Hole Win</span>
              <span class="pts-row-desc">Points for winning a hole outright</span>
            </div>
            <div class="pts-stepper">
              <button type="button" onclick="stepPts('wz-pts-hole',-1)">‚àí</button>
              <input type="number" id="wz-pts-hole" value="1" min="1" max="5" step="1" readonly />
              <button type="button" onclick="stepPts('wz-pts-hole',1)">+</button>
            </div>
          </div>

          <!-- Low net match bonus -->
          <div class="pts-row">
            <div class="pts-row-label">
              <span class="pts-row-name">Low Net Match Bonus</span>
              <span class="pts-row-desc">Bonus for lowest net score within the HI or LO matchup</span>
            </div>
            <div class="pts-stepper">
              <button type="button" onclick="stepPts('wz-pts-lownet',-1)">‚àí</button>
              <input type="number" id="wz-pts-lownet" value="1" min="0" max="5" step="1" readonly />
              <button type="button" onclick="stepPts('wz-pts-lownet',1)">+</button>
            </div>
          </div>

          <!-- Low team net bonus -->
          <div class="pts-row">
            <div class="pts-row-label">
              <span class="pts-row-name">Low Team Net Bonus</span>
              <span class="pts-row-desc">Bonus for team with lowest combined net score (Bushwood style = 1)</span>
            </div>
            <div class="pts-stepper">
              <button type="button" onclick="stepPts('wz-pts-teamnet',-1)">‚àí</button>
              <input type="number" id="wz-pts-teamnet" value="0" min="0" max="5" step="1" readonly />
              <button type="button" onclick="stepPts('wz-pts-teamnet',1)">+</button>
            </div>
          </div>

          <!-- Birdie bonus -->
          <div class="pts-row">
            <div class="pts-row-label">
              <span class="pts-row-name">Birdie Bonus</span>
              <span class="pts-row-desc">Extra point(s) awarded for scoring a birdie (gross)</span>
            </div>
            <div class="pts-stepper">
              <button type="button" onclick="stepPts('wz-pts-birdie',-1)">‚àí</button>
              <input type="number" id="wz-pts-birdie" value="0" min="0" max="5" step="1" readonly />
              <button type="button" onclick="stepPts('wz-pts-birdie',1)">+</button>
            </div>
          </div>

          <!-- Eagle bonus -->
          <div class="pts-row">
            <div class="pts-row-label">
              <span class="pts-row-name">Eagle Bonus</span>
              <span class="pts-row-desc">Extra point(s) awarded for scoring an eagle or better (gross)</span>
            </div>
            <div class="pts-stepper">
              <button type="button" onclick="stepPts('wz-pts-eagle',-1)">‚àí</button>
              <input type="number" id="wz-pts-eagle" value="0" min="0" max="5" step="1" readonly />
              <button type="button" onclick="stepPts('wz-pts-eagle',1)">+</button>
            </div>
          </div>

        </div>

        <!-- Live preview of max pts -->
        <div class="pts-preview" id="pts-preview"></div>

      </div>

      <div class="wizard-section">
        <div class="wizard-section-title">Missing Player Rules</div>
        <div class="field">
          <label>Primary Rule <span class="info-btn" data-tip="What happens when a player doesn't show up">?</span></label>
          <select id="wz-absent-rule" onchange="toggleAbsentScoreInput(this.value)">
            <option value="blind_avg">Blind draw ‚Äî use league average score</option>
            <option value="last_score">Use player's last recorded score</option>
            <option value="duplicate_prev">Duplicate previous week's score</option>
            <option value="worst_score">Worst score over last N weeks</option>
            <option value="fixed_score">Use a fixed score (enter below)</option>
            <option value="vs_par">Play against par (no handicap)</option>
            <option value="plays_both">Present player plays both opponents</option>
            <option value="forfeit">Forfeit ‚Äî opponent wins all holes</option>
            <option value="half_pts">Half points to both sides</option>
            <option value="sub">Allow substitute player</option>
          </select>
        </div>
        <div class="field" id="absent-fixed-score-field" style="display:none">
          <label>Fixed Absent Score (gross strokes)</label>
          <input type="number" id="wz-absent-fixed-score" placeholder="e.g. 45" min="18" max="99" style="max-width:140px" />
          <p class="field-hint">This gross score will be used any time a player is absent.</p>
        </div>
        <div class="field" id="absent-worst-lookback-field" style="display:none">
          <label>Worst Score Lookback <span class="info-btn" data-tip="How many of the player's most recent weeks to scan for their worst score">?</span></label>
          <div style="display:flex;align-items:center;gap:10px">
            <input type="number" id="wz-absent-worst-lookback" value="4" min="1" max="18" style="max-width:90px" />
            <span style="color:var(--mt);font-size:13px">weeks</span>
          </div>
          <p class="field-hint">The absent player is given their single worst gross score from the last N weeks (or their worst ever score if they have fewer rounds). Encourages showing up!</p>
        </div>
      </div>

      <div class="wizard-section">
        <div class="wizard-section-title">Skins</div>
        <div class="field">
          <label>Enable Skins</label>
          <div class="toggle-group" id="tg-skins">
            <button class="toggle-btn active" data-value="yes">Yes</button>
            <button class="toggle-btn" data-value="no">No</button>
          </div>
          <input type="hidden" id="wz-skins-val" value="yes" />
        </div>
        <div class="field-row">
          <div class="field">
            <label>Skins Buy-In ($)</label>
            <input type="number" id="wz-skins-buyin" value="2" min="0" />
          </div>
          <div class="field">
            <label>Weekly Buy-In ($)</label>
            <input type="number" id="wz-weekly-buyin" value="5" min="0" />
          </div>
        </div>
        <div class="field">
          <label>Skins Type</label>
          <div class="toggle-group" id="tg-skins-type">
            <button class="toggle-btn active" data-value="gross">Gross</button>
            <button class="toggle-btn" data-value="net">Net</button>
          </div>
          <input type="hidden" id="wz-skins-type-val" value="gross" />
        </div>
      </div>
    </div>

    <!-- Step 5: Handicap -->
    <div class="wizard-step">
      <h2 class="wizard-step-title">Handicap Settings</h2>
      <p class="wizard-step-sub">How are handicaps calculated?</p>

      <div class="wizard-section">
        <div class="wizard-section-title">System</div>
        <div class="field">
          <label>Handicap System</label>
          <div class="toggle-group" id="tg-hcpsys">
            <button class="toggle-btn active" data-value="custom">Custom Rolling</button>
            <button class="toggle-btn" data-value="whs">WHS (World Handicap)</button>
            <button class="toggle-btn" data-value="manual">Manual Input</button>
            <button class="toggle-btn" data-value="scratch">Scratch (none)</button>
          </div>
          <input type="hidden" id="wz-hcp-sys-val" value="custom" />
        </div>

        <div id="hcp-custom-settings">
          <div class="field">
            <label>Rounds Used to Calculate
              <span class="info-btn" data-tip="How many recent rounds factor into the handicap">?</span>
            </label>
            <div style="display:flex;align-items:center;gap:12px;margin-top:4px">
              <input type="range" id="wz-hcp-rounds-slider" min="1" max="20" value="5" style="flex:1" oninput="document.getElementById('wz-hcp-rounds-display').textContent=this.value;document.getElementById('wz-hcp-rounds-val').value=this.value;document.getElementById('hcp-rounds-hint').textContent=this.value;renderHcpManualTable()" />
              <span id="wz-hcp-rounds-display" style="font-size:18px;font-weight:700;color:var(--ac);min-width:28px">5</span>
            </div>
            <input type="hidden" id="wz-hcp-rounds-val" value="5" />
          </div>

          <div class="field">
            <label>Drop Scores
              <span class="info-btn" data-tip="Remove outlier scores before calculating the average">?</span>
            </label>
            <div class="toggle-group" id="tg-hcpdrop">
              <button class="toggle-btn active" data-value="none">None</button>
              <button class="toggle-btn" data-value="low">Drop Lowest</button>
              <button class="toggle-btn" data-value="high">Drop Highest</button>
              <button class="toggle-btn" data-value="both">Drop Both</button>
            </div>
            <input type="hidden" id="wz-hcp-drop-val" value="none" />
          </div>

          <div class="field-row">
            <div class="field">
              <label>Reduction Factor</label>
              <input type="number" id="wz-hcp-factor" value="0.9" min="0.5" max="1" step="0.05" />
              <p class="field-hint">0.9 = 90% of index</p>
            </div>
            <div class="field">
              <label>Max Handicap</label>
              <input type="number" id="wz-hcp-max" value="18" min="1" max="54" />
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Step 6: Schedule -->
    <div class="wizard-step">
      <h2 class="wizard-step-title">Schedule</h2>
      <p class="wizard-step-sub">Review and adjust your weekly schedule</p>

      <div class="wizard-section">
        <div class="wizard-section-title">Schedule Type</div>
        <div class="field">
          <div class="toggle-group" id="tg-schedtype">
            <button class="toggle-btn active" data-value="auto">Auto Round Robin</button>
            <button class="toggle-btn" data-value="manual">Manual</button>
          </div>
          <input type="hidden" id="wz-sched-type-val" value="auto" />
          <p class="field-hint" id="rr-hint">Teams will play each other an even number of times</p>
        </div>
        <div class="field">
          <label>Playoff Format</label>
          <div class="toggle-group" id="tg-playoffs">
            <button class="toggle-btn active" data-value="0">No Playoffs</button>
            <button class="toggle-btn" data-value="1">1 Week (Final)</button>
            <button class="toggle-btn" data-value="2">2 Weeks (Semi + Final)</button>
            <button class="toggle-btn" data-value="3">3 Weeks (QF/SF/F)</button>
          </div>
          <input type="hidden" id="wz-playoffs-val" value="0" />
        </div>
      </div>

      <div class="wizard-section">
        <div class="wizard-section-title">Weekly Dates
          <div style="display:inline-flex;gap:8px;float:right">
            <button class="btn-ghost" onclick="addScheduleWeek()" style="font-size:12px;padding:4px 10px">+ Add Week</button>
          </div>
        </div>
        <div id="schedule-container"></div>
      </div>
    </div>

  </div><!-- end wizard-body -->

  <div class="wizard-footer">
    <span id="wizard-step-label" style="font-size:12px;color:var(--mt)">Step 1 of 6</span>
    <div class="wizard-footer-btns">
      <button class="btn-wizard-next" id="wizard-next-btn">Next ‚Üí</button>
    </div>
  </div>
</section>

<!-- ===== MAIN LEAGUE APP ===== -->
<section id="view-app" class="view">

  <!-- Header -->
  <div class="app-header" role="banner">
    <div class="app-header-left">
      <div class="app-logo-icon"><img src="/logo.png" alt="FairwayCaddie" /></div>
      <div class="app-header-titles">
        <h1 id="app-league-name">My League</h1>
        <div class="league-sub" id="app-league-sub">Season 2025</div>
      </div>
    </div>
    <div class="app-header-right">
      <button class="league-switcher-btn" id="btn-switch-league">Leagues</button>
      <div class="profile-menu-wrap">
        <div class="user-avatar" id="user-avatar" title="Account" role="button" tabindex="0" aria-label="Account menu" aria-haspopup="true" aria-expanded="false">üë§</div>
        <div class="profile-menu" id="profile-menu">
          <div class="profile-menu-header">
            <div class="pm-name" id="pm-name"></div>
            <div class="pm-email" id="pm-email"></div>
          </div>
          <button class="profile-menu-item" onclick="showView('terms')">Terms of Service</button>
          <button class="profile-menu-item" onclick="showView('privacy')">Privacy Policy</button>
          <div class="profile-menu-divider"></div>
          <button class="profile-menu-item danger" onclick="handleSignOut()">Sign Out</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Nav tabs -->
  <nav class="app-nav" role="navigation" aria-label="League sections">
    <button class="nav-tab active" data-tab="dashboard">My</button>
    <button class="nav-tab" data-tab="scores">Scores</button>
    <button class="nav-tab" data-tab="standings">Standings</button>
    <button class="nav-tab" data-tab="handicaps">HCP</button>
    <button class="nav-tab" data-tab="skins">Skins</button>
    <button class="nav-tab" data-tab="stats">Stats</button>
    <button class="nav-tab" data-tab="schedule">Schedule</button>
    <button class="nav-tab" data-tab="recap">Recap</button>
    <button class="nav-tab" data-tab="rules">Rules</button>
    <button class="nav-tab" data-tab="history">History</button>
    <div class="admin-dropdown-wrap" id="admin-dropdown-wrap" style="display:none">
      <button class="admin-dropdown-btn" id="admin-dropdown-btn" onclick="toggleAdminDropdown()" aria-label="Admin menu" aria-haspopup="true" aria-expanded="false">
        Admin <span class="admin-caret">‚ñæ</span>
      </button>
      <div class="admin-dropdown-menu" id="admin-dropdown-menu">
        <button class="admin-dropdown-item" data-tab="admin-members" onclick="adminNavTo('admin-members')">Members</button>
        <button class="admin-dropdown-item" data-tab="admin-scores" onclick="adminNavTo('admin-scores')">Scores</button>
        <button class="admin-dropdown-item" data-tab="admin-teams" onclick="adminNavTo('admin-teams')">Teams</button>
        <button class="admin-dropdown-item" data-tab="admin-settings" onclick="adminNavTo('admin-settings')">Settings</button>
      </div>
    </div>
  </nav>

  <!-- Content -->
  <div class="app-content" role="main">
    <div id="tab-dashboard"      class="app-tab active"></div>
    <div id="tab-scores"         class="app-tab"></div>
    <div id="tab-standings"      class="app-tab"></div>
    <div id="tab-handicaps"      class="app-tab"></div>
    <div id="tab-skins"          class="app-tab"></div>
    <div id="tab-stats"          class="app-tab"></div>
    <div id="tab-schedule"       class="app-tab"></div>
    <div id="tab-recap"          class="app-tab"></div>
    <div id="tab-rules"          class="app-tab"></div>
    <div id="tab-history"        class="app-tab"></div>
    <div id="tab-admin-members"  class="app-tab"></div>
    <div id="tab-admin-scores"   class="app-tab"></div>
    <div id="tab-admin-teams"    class="app-tab"></div>
    <div id="tab-admin-settings" class="app-tab"></div>
  </div>

</section>

<!-- ===== TOAST ===== -->
<div id="toast" role="status" aria-live="polite"></div>

<!-- ===== SCORE ENTRY MODAL ===== -->
<!-- Course Request Modal -->
<div id="course-request-modal" class="modal-overlay" style="display:none" onclick="closeCourseRequestModal(event)">
  <div class="modal-sheet" style="max-width:480px">
    <div class="modal-header">
      <div class="modal-header-info">
        <h2 class="modal-title">Request a Course</h2>
      </div>
      <button class="modal-close-btn" onclick="closeCourseRequestModal()">‚úï</button>
    </div>
    <div style="padding:16px;display:flex;flex-direction:column;gap:12px">
      <p class="field-hint">Can't find your course? Submit a request and we'll add it to the database.</p>
      <div class="field">
        <label>Course Name *</label>
        <input type="text" id="cr-course-name" placeholder="e.g. Pine Valley Golf Club" />
      </div>
      <div class="field">
        <label>City / State *</label>
        <input type="text" id="cr-course-city" placeholder="e.g. Pine Valley, NJ" />
      </div>
      <div class="field">
        <label>Scorecard Photo (optional)</label>
        <div class="upload-zone" id="cr-upload-zone" onclick="document.getElementById('cr-scorecard-file').click()" style="padding:16px">
          <span class="upload-zone-icon">üì∑</span>
          <p><strong>Tap to upload a scorecard photo</strong></p>
        </div>
        <input type="file" id="cr-scorecard-file" accept="image/*" style="display:none" />
        <div id="cr-upload-preview" style="display:none">
          <img id="cr-preview-img" src="" alt="Scorecard preview" style="max-width:100%;border-radius:8px;margin-top:8px" />
        </div>
      </div>
      <button class="btn btn-green" id="cr-submit-btn" onclick="submitCourseRequest()">Submit Request</button>
    </div>
  </div>
</div>

<div id="match-modal" class="modal-overlay" style="display:none" onclick="closeMatchModal(event)">
  <div class="modal-sheet" id="modal-sheet">

    <!-- Header -->
    <div class="modal-header">
      <div class="modal-header-info">
        <div class="modal-week-badge" id="modal-week-badge">Week 1</div>
        <h2 class="modal-title" id="modal-title">Team A vs Team B</h2>
        <div class="modal-meta" id="modal-meta"></div>
      </div>
      <button class="modal-close-btn" onclick="closeMatchModal()">‚úï</button>
    </div>

    <!-- Status bar -->
    <div class="modal-status-bar" id="modal-status-bar"></div>

    <!-- Score grid -->
    <div class="modal-body">

      <!-- HI match -->
      <div class="match-section" id="modal-hi-section">
        <div class="match-section-label">
          <span class="hilo-badge hi">HI</span>
          <span id="modal-hi-label">Player A vs Player B</span>
        </div>
        <div class="score-grid-wrap">
          <table class="score-grid" id="modal-hi-grid"></table>
        </div>
        <div class="match-pts-row" id="modal-hi-pts"></div>
      </div>

      <!-- LO match -->
      <div class="match-section" id="modal-lo-section">
        <div class="match-section-label">
          <span class="hilo-badge lo">LO</span>
          <span id="modal-lo-label">Player C vs Player D</span>
        </div>
        <div class="score-grid-wrap">
          <table class="score-grid" id="modal-lo-grid"></table>
        </div>
        <div class="match-pts-row" id="modal-lo-pts"></div>
      </div>

      <!-- Team totals -->
      <div class="team-totals-row" id="modal-team-totals"></div>

    </div><!-- end modal-body -->

    <!-- Footer actions -->
    <div class="modal-footer" id="modal-footer"></div>

  </div>
</div>

<!-- ===== TERMS OF SERVICE ===== -->
<section id="view-terms" class="view">
  <div class="legal-page">
    <button class="btn-ghost" onclick="history.back ? window._legalBack() : showView('splash')" style="margin-bottom:16px;text-align:left">‚Üê Back</button>
    <h2>Terms of Service</h2>
    <p class="legal-updated">Last updated: February 24, 2026</p>
    <div class="legal-body">
      <h3>1. Acceptance of Terms</h3>
      <p>By creating an account or using FairwayCaddie ("the Service"), you agree to these Terms of Service. If you do not agree, do not use the Service.</p>

      <h3>2. Description of Service</h3>
      <p>FairwayCaddie is a free web application for managing recreational golf leagues ‚Äî including teams, schedules, scores, handicaps, standings, and statistics. The Service is provided "as is" for personal, non-commercial use.</p>

      <h3>3. User Accounts</h3>
      <p>You must provide accurate information when creating an account. You are responsible for maintaining the security of your credentials. You must be at least 13 years old to use the Service.</p>

      <h3>4. Acceptable Use</h3>
      <p>You agree not to: (a) use the Service for any unlawful purpose; (b) submit false, misleading, or offensive content; (c) attempt to interfere with or disrupt the Service; (d) access other users' data without authorization.</p>

      <h3>5. Content &amp; Data</h3>
      <p>You retain ownership of any data you enter (league names, scores, player names). We may store and process this data to operate the Service. League commissioners may view and manage data within their league.</p>

      <h3>6. Availability &amp; Disclaimers</h3>
      <p>The Service is provided free of charge with no guarantee of uptime, accuracy, or availability. We may modify, suspend, or discontinue the Service at any time without notice. We are not liable for any loss of data.</p>

      <h3>7. Limitation of Liability</h3>
      <p>To the maximum extent permitted by law, FairwayCaddie and its operators shall not be liable for any indirect, incidental, special, or consequential damages arising from your use of the Service.</p>

      <h3>8. Changes to Terms</h3>
      <p>We may update these Terms at any time. Continued use of the Service after changes constitutes acceptance of the new Terms.</p>

      <h3>9. Contact</h3>
      <p>Questions about these Terms? Contact us at <strong>support@fairwaycaddie.com</strong></p>
    </div>
  </div>
</section>

<!-- ===== PRIVACY POLICY ===== -->
<section id="view-privacy" class="view">
  <div class="legal-page">
    <button class="btn-ghost" onclick="history.back ? window._legalBack() : showView('splash')" style="margin-bottom:16px;text-align:left">‚Üê Back</button>
    <h2>Privacy Policy</h2>
    <p class="legal-updated">Last updated: February 24, 2026</p>
    <div class="legal-body">
      <h3>1. Information We Collect</h3>
      <p><strong>Account data:</strong> When you sign up, we collect your name, email address, and (if you choose Google sign-in) your Google profile information.</p>
      <p><strong>League data:</strong> Scores, handicaps, team assignments, schedules, and other league-related information you enter.</p>
      <p><strong>Usage data:</strong> We may collect basic analytics such as pages visited and feature usage to improve the Service.</p>

      <h3>2. How We Use Your Information</h3>
      <p>We use your information to: (a) operate and maintain your league; (b) display scores, standings, and statistics to league members; (c) send account-related emails (verification, password reset); (d) improve the Service.</p>

      <h3>3. Data Sharing</h3>
      <p>We do not sell your personal information. Your league data is visible to other members of the same league. We may share data with Firebase (Google Cloud) for hosting and database services.</p>

      <h3>4. Data Storage &amp; Security</h3>
      <p>Your data is stored on Google Firebase servers. We use industry-standard security measures including encrypted connections (HTTPS) and Firebase Authentication. However, no system is 100% secure.</p>

      <h3>5. Your Rights</h3>
      <p>You may: (a) access and update your account information at any time; (b) request deletion of your account and associated data by contacting us; (c) export your league data through the admin panel.</p>

      <h3>6. Cookies</h3>
      <p>We use essential cookies and local storage for authentication and session management. We do not use third-party advertising cookies.</p>

      <h3>7. Children's Privacy</h3>
      <p>The Service is not directed at children under 13. We do not knowingly collect data from children under 13.</p>

      <h3>8. Changes to This Policy</h3>
      <p>We may update this Privacy Policy at any time. Changes will be posted on this page with an updated date.</p>

      <h3>9. Contact</h3>
      <p>Questions about this Privacy Policy? Contact us at <strong>support@fairwaycaddie.com</strong></p>
    </div>
  </div>
</section>

<!-- app.js: non-module, runs first, sets up globals and DOM listeners -->
<script src="app.js"></script>

<!-- Firebase boot: firebase-config.js sets window._FB on init.
     This module merges in firestore-sync helpers and boots auth state. -->
<script type="module">
  // firebase-config.js initializes Firebase AND sets window._FB as a side effect
  import { onAuthStateChanged, getAuth } from './firebase-config.js';

  // Merge firestore-sync helpers into window._FB (best-effort ‚Äî errors won't break auth)
  try {
    const sync = await import('./firestore-sync.js');
    Object.assign(window._FB, {
      loadUserProfile:      sync.loadUserProfile,
      saveUserProfile:      sync.saveUserProfile,
      loadUserLeagues:      sync.loadUserLeagues,
      addUserLeagueIndex:   sync.addUserLeagueIndex,
      createLeague:         sync.createLeague,
      setActiveLeague:      sync.setActiveLeague,
      loadMembership:       sync.loadMembership,
      saveMembership:       sync.saveMembership,
      loadAllMembers:       sync.loadAllMembers,
      findLeagueByJoinCode: sync.findLeagueByJoinCode,
      joinLeague:           sync.joinLeague,
      removeMember:         sync.removeMember,
      regenerateJoinCode:   sync.regenerateJoinCode,
      loadLeagueConfig:     sync.loadLeagueConfig,
      loadLeagueMeta:       sync.loadLeagueMeta,
      saveLeagueMeta:       sync.saveLeagueMeta,
      listenLeagueConfig:   sync.listenLeagueConfig,
      listenMatches:        sync.listenMatches,
      listenPlayerRounds:   sync.listenPlayerRounds,
      saveMatch:            sync.saveMatch,
      submitScores:         sync.submitScores,
      approveScores:        sync.approveScores,
      rejectScores:         sync.rejectScores,
      forceCommitMatch:     sync.forceCommitMatch,
      unlockMatch:          sync.unlockMatch,
      savePlayerRounds:     sync.savePlayerRounds,
      saveLeagueConfig:     sync.saveLeagueConfig,
      deleteMatch:          sync.deleteMatch,
      createMatchDocs:      sync.createMatchDocs,
      archiveAndRollover:   sync.archiveAndRollover,
      disputeScores:        sync.disputeScores,
      uploadPlayerPhoto:    sync.uploadPlayerPhoto,
      hardReset:            sync.hardReset,
      deleteLeague:         sync.deleteLeague,
      importLeagueData:     sync.importLeagueData,
    });
    console.log('[Boot] firestore-sync loaded');
  } catch (err) {
    console.error('[Boot] firestore-sync failed to load:', err);
  }

  const loading = document.getElementById('splash-loading');
  const btns    = document.getElementById('splash-btns');

  let booted = false;
  onAuthStateChanged(getAuth(), async (user) => {
    if (booted) return;
    booted = true;
    if (loading) loading.style.display = 'none';
    if (user) {
      window._currentUser = user;
      if (window.Sentry) Sentry.setUser({ id: user.uid, email: user.email });
      // Gate email/password users who haven't verified their email
      // Only enforce for accounts created AFTER verification was enabled
      const VERIFICATION_CUTOFF = new Date('2026-02-24T00:00:00Z').getTime();
      const isEmailProvider = user.providerData?.some(p => p.providerId === 'password');
      const createdAt = user.metadata?.creationTime ? new Date(user.metadata.creationTime).getTime() : 0;
      const isNewAccount = createdAt >= VERIFICATION_CUTOFF;
      if (isEmailProvider && !user.emailVerified && isNewAccount) {
        const addrEl = document.getElementById('verify-email-addr');
        if (addrEl) addrEl.textContent = user.email || '';
        window.showView('verify-email');
      } else {
        await window.showLeagueSelect();
      }
    } else {
      window._currentUser = null;
      if (window.Sentry) Sentry.setUser(null);
      if (btns) btns.style.display = 'flex';
    }
  });
</script>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js').then(reg => {
    // Force iOS to check for a new SW on every page load
    reg.update();
    // When a new SW finishes installing, tell it to skip waiting
    reg.addEventListener('updatefound', () => {
      const nw = reg.installing;
      nw.addEventListener('statechange', () => {
        if (nw.state === 'installed' && navigator.serviceWorker.controller) {
          nw.postMessage({ type: 'SKIP_WAITING' });
        }
      });
    });
  }).catch(e => console.warn('[SW]', e));
  // When the new SW takes control, reload once to get fresh assets
  let refreshing = false;
  navigator.serviceWorker.addEventListener('controllerchange', () => {
    if (!refreshing) { refreshing = true; window.location.reload(); }
  });
}
</script>

</body>
</html>
